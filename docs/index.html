<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Arduino Synthesizer : A 1-bit DAC built with Arduino and C" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <link href='https://fonts.googleapis.com/css?family=Roboto:400,400italic,700italic,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:300,300italic,700,700italic' rel='stylesheet' type='text/css'>

    <title>Arduino Synthesizer : A 1-bit DAC built with Arduino and C</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/NathanYee/softwareSystemsTangyTurtles}}">View on GitHub</a>

          <h1 id="project_title">Arduino Synthesizer</h1>
          <h2 id="project_tagline">1-bit DAC</h2>
        </header>
    </div>

    <section class="outer">
        <div class="downloads inner">
          <a class="https://github.com/NathanYee/softwareSystemsTangyTurtles/archive/master.zip" href="#">Download .zip</a>
        </div>
    </section>


    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">


        <h1>The Team</h1>
        <p>
          <a href="https://github.com/shanek21" >Shane Kelly</a>,
          <a href="https://github.com/cmoser96" >Carl Moser</a>,
          <a href="https://github.com/NathanYee">Nathan Yee</a>
        </p>

        <h1>Big Idea</h1>
        <p>
          We created a synthesizer that can play sinusoidal waves through a speaker of a user-specified frequency. A specially formatted file type can then be passed to the Arduino to command it to play certain notes in sequence, which create songs!
        </p>

        <h1>Background</h1>
        <p>
          The foundation of this project is creating a wave and outputting it with an Arduino's PWM pin. The most basic waveform is a square wave oscillating between values of 0 and 255. The Arduino’s Timer 2 (TCNT2) counts from 0 to 255 before overflowing and restarting its count at 0. The timer knows when to overflow by comparing its value to the value stored in the “Output Compare Register” (OCR1A).  We can change the value at which TCNT2 overflows (and thus, the wave's frequency) by adjusting the register value stored in OCR1A.
        <br>
          When the calculated wave is played to a speaker, the wave will sound choppy because an Arduino can only simulate analog output values by slamming its PWM pin from 0 to 255 at different duty cycles. A DAC must be used to convert these digital waves to smooth analog waves - in our case we used a 1-bit DAC that low-passed the wave to smooth it out.
        <br>
          After a wave of a specified frequency can be played on the Arduino, then serial commands simply need to be sent to the Arduino to specify what frequencies should be played. Under the everything-is-a-file architecture, this can be accomplished by opening a serial port and writing the contents of a song file to the port.
        </p>

        <h1>Implementation</h1>
        <p>
          Once the Arduino generated an output wave from its PWM port, we ran the andigital signal through a 1-bit DAC. Our DAC essentially acts as a low-pass filter, which smooths the jagged PWM signal in order to create a batter waveform to be played through a speaker.
        <br />
          To play a specified song on our Arduino synthesizer, we created a file type that stores a sequence of tone frequencies and tone durations. We then passed this information to the Arduino through serial. We took advantage of the small-C-tools architecture to translate information from a file/standard input to a specified serial port. The tool that we wrote to take care of this is <a href="https://github.com/NathanYee/softwareSystemsTangyTurtles/blob/master/code/stdinToSerial/stdinToSerial.c">stdinToSerial.c</a>, which can have any file passed through it and have that file's contents be pushed to any serial port.
        <br />
          The last design decision that we made was to use Arduino's implementation of serial to be able to update the frequency. We attempted to implement a c version of serial communication using the serial registers directly. This caused an issue with all serial communication (even after uploading other code) with the arduino. We are not sure what exactly happened but we believe that a fuse bit within the arduino might have been changed during testing. Since we are not sure what caused the issue and did not want to risk breaking more arduinos, we decided to switch to Arduino's implementation because we knew that it would work.
        </p>

        <h1>Results</h1>
        <center><iframe width="420" height="315" src="https://www.youtube.com/watch?v=dQw4w9WgXcQ"></iframe></center>
        <p>We have created an Arduino synthesizer that can be commanded to play a series of tones from an input file that specifies the frequency and duration of each sequential tone. The tones are played through a simple 1-bit DAC, which low-pass filters the output of the Arduino's PWM signals to create smooth waveforms.</p>
        <center>
          <img src="images/Unfiltered.png" alt="Unfiltered Waveform">
          <p>
            The unfiltered signal outputted by the Arduino
          </p>
          <br />

          <img src="images/Filtered.png" alt="Filtered Waveform">
        </center>

        <h1>Resources</h1>
        <p>
          <a href="http://makezine.com/projects/make-35/advanced-arduino-sound-synthesis/ ">Skill Builder: Advanced Arduino Sound Synthesis, Jon Thompson</a>
          <br>
          <a href="https://www.appelsiini.net/2011/simple-usart-with-avr-libc ">Serial communications on an Arduino in C</a>
          <br>
          <a href="https://www.arduino.cc/en/Reference/PortManipulation ">Arduino port registers.</a>
        </p>

        <h1>Usage</h1>
        <h4>Playing song files using Arduino IDE</h4>
        <p>
          Upload <code>code/arduino/arduino.ino</code> to the Arduino Uno using the Arduino IDE.<br />
          Once the Arduino code has been uploaded, send the desired song file to the serial port that the Arduino is currently connected to. The <code>-f</code> option will set the song filename and the <code>-p</code> option will set the serial port.<br />
          <code>cd ../stdinToSerial</code> <br />
          <code>make</code><br />
          <code>./stdinToSerial -f twinkleTwinkle.csv -p /dev/ttyACM0</code> <br />
        </p>
        <h4>Playing single tones with C using AVR-DUDE</h4>
        <p>
          Compile the Arduino code and upload it to the Uno.<br />
          <code>cd code/arduino</code><br />
          <code>bash compile.sh listing1</code><br />
        </p>

        <h1>License</h1>
          <a href="https://github.com/NathanYee/softwareSystemsTangyTurtles/blob/master/LICENSE.txt">MIT License</a>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Slate theme maintained by <a href="https://github.com/jasoncostello">Jason Costello</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

  </body>
</html>
